<h1>Api обмена</h1>
<h2>Схема параметров</h2>
<p>
Для обмена сообщениями в серверах ii используется понятие схемы параметров. Она представляет из себя строку, которая передаётся серверу через GET запрос, состоящую из слешей и того, что находится между ними. Пример: <b>/u/e/echoname.100</b>. Разные параметры этой схемы отвечают за разную выдачу или принятие информации сервером.</p>
<p>
В настоящее время у нас используется схема /u/ (универсальная), поэтому обычно адрес сервера в клиенте должен прописываться в формате <b>http://server-adress/u/</b> (для php ноды <b>http://server-adress/ii-script.php?q=/u/</b>).</p>

<h2>обработчики /u/</h2>

<p>/u/ - это запросы для обмена сообщениями, на которых и строится вся синхронизация.</p>

<p>Вся синхронизация - односторонняя. Две ноды просто собирают друг у друга сообщения. Пойнты же, наоборот, проталкивают свои письма, которые нод делает полноценными сообщениями сети, одобряя их (или не делает, не одобряя).</p>

<h2>/u/e/эха.номер/эха.номер/эха.номер...</h2>
Список сообщений из заданных эхоконференций, в формате:
<pre>
эха
msgid
msgid
msgid
эха
msgid
</pre>
<p>Отличить эху от сообщения очень просто - в имени эхи есть точка, а в номере сообщения - нет.</p>

<h2>/u/m/msgid/msgid/msgid...</h2>
бандл сообщений, в формате
<pre>
строка:код
строка:код
</pre>
где строка - это msgid, а код - закодированное base64 <a href="?p=2#bundle">сообщение</a> (все серверы обязаны принимать как обычный, так и urlsafe-словарь, генерируются же бандлы в формате обычного base64)
<h2>GET /u/point/pauth/tmsg или POST /u/point</h2>

<p>Передаёт пользовательское сообщение на ноду в виде запакованного текста base64 определённого <a href="?p=2#pointmsg">формата</a> (если сообщение передавать через get-запрос, то оно там уже обязано быть base64_urlsafe).
pauth здесь - поинтовая строка авторизации, tmsg - закодированное base64 сообщение. В случае POST параметры называются так же: pauth и tmsg.
</p>
<h2>/u/push - push-ноды</h2>

<p>Кроме отправки данных, ноды могут (но не обязаны) реализовывать формат push, который принимает нодовые сообщения. push - это бандл наоборот. если фетчинг скачивает бандлы, то push их проталкивает на другой узел (нодовый или пойнтовый).</p>

<p>Ноды, которые поддерживают /u/push, называются push-ноды. Сначала у них запрашивается список сообщений, которые уже есть в эхе, а затем через /u/push загружаются недостающие. Формат засылки можно найти на странице.

<h2>Другие схемы</h2>
<h3>/e/эха.номер</h3>
<p>Выдаёт файл определённой эхоконференции для просмотра вручную. В обмене не применяется.</p>
<h3>/m/msgid</h3>
<p>Выдаёт сообщение из <span class='cd'>msg/</span>, в обмене также не используется, служит для отладки.</p>
